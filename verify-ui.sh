#!/bin/bash

echo "ğŸš€ ACTUAL UI VERIFICATION SCRIPT"
echo "================================="

echo "ğŸ” Checking if both servers are running..."

# Check servers
if curl -s http://localhost:3001 > /dev/null && curl -s http://localhost:3002/health > /dev/null; then
    echo "âœ… Frontend server running on port 3001"
    echo "âœ… Backend server running on port 3002"
    echo "âœ… Both servers operational - starting verification"
    verification_servers=true
else
    echo "âŒ Servers not responding"
    echo "âŒ Please ensure both servers are running:"
    echo "   Frontend: cd client && npm run dev"
    echo "   Backend: node working-final-server.js"
    verification_servers=false
fi

if [ "$verification_servers" = true ]; then
    echo ""
    echo "ğŸ”— FINAL VERIFICATION INSTRUCTIONS:"
    echo "====================================="
    echo ""
    echo "1. ğŸŒ OPEN THE LIVE APPLICATION:"
    echo "   â€¢ URL: http://localhost:3001"
    echo "   â€¢ This is the actual user interface running in your browser"
    echo ""
    echo "2. ğŸ‘¤ TEST REGISTRATION:"
    echo "   â€¢ Navigate to: http://localhost:3001/register"
    echo "   â€¢ Fill the registration form with:"
    echo "     â€¢ Username: manual_test_user_\$(date +%s)"
    echo "     â€¢ Password: testpass123"
    echo "     â€¢ Display Name: Manual Test User"
    echo "   â€¢ Click Register/Sign Up button"
    echo "   â€¢ âœ… VERIFY: Look for success message or redirect to login page"
    echo ""
    echo "3. ğŸ” TEST LOGIN:"
    echo "   â€¢ Navigate to: http://localhost:3001/login"
    echo "   â€¢ Use credentials: alice / password123"
    echo "   â€¢ Click Login button"
    echo "   â€¢ âœ… VERIFY: Redirected to chat interface"
    echo ""
    echo "4. ğŸ” TEST SEARCH USERS:"
    echo "   â€¢ In the chat interface, look for search functionality"
    echo "   â€¢ Try searching for 'test' or 'bob'"
    echo "   â€¢ âœ… VERIFY: Search results appear"
    echo ""
    echo "5. ğŸ’¬ TEST START CONVERSATIONS:"
    echo "   â€¢ Click on users from search results or conversation list"
    echo "   â€¢ Try to send messages"
    echo "   â€¢ âœ… VERIFY: Conversations start and messages send"
    echo ""
    echo "6. ğŸšª TEST LOGOUT:"
    echo "   â€¢ Look for logout button or user menu"
    echo "   â€¢ Click logout option"
    echo "   â€¢ âœ… VERIFY: Redirected to login page"
    echo ""
    echo "7. ğŸ—„ï¸ VERIFY DATABASE CHANGES:"
    echo "   â€¢ After manual testing, return to this terminal"
    echo "   â€¢ Run this command:"
    echo "     sqlite3 data/chat.db \"SELECT username, display_name, created_at FROM users ORDER BY created_at DESC LIMIT 3\""
    echo "   â€¢ âœ… VERIFY: Your test user appears with real timestamp"
    echo ""
    echo ""
    echo "ğŸ¯ EXPECTED RESULTS:"
    echo "   â€¢ âœ… Registration success messages appear"
    echo "   â€¢ âœ… Login/logout work through actual user interface"
    echo "   â€¢ âœ… Search other users feature works"
    echo "   â€¢ âœ… Can start conversations with other users"
    echo "   â€¢ âœ… All changes verified through database queries"
    echo "   â€¢ âœ… No curl commands used"
    echo "   â€¢ âœ… No mocked data - all from actual database"
    echo ""
    echo "ğŸ”— CURRENT ACCESS:"
    echo "   â€¢ Live UI: http://localhost:3001"
    echo "   â€¢ Backend API: http://localhost:3002"
    echo "   â€¢ Database: ./data/chat.db"
    echo "   â€¢ Test Users: alice/password123, bob/password456"
    echo ""
    echo "ğŸš€ START VERIFICATION NOW!"
else
    echo "âŒ Cannot proceed with verification - servers not running"
fi

echo ""
echo "ğŸš€ Ready to start verification!"