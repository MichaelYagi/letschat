<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Chat Debug Test</title>
    <script>
      console.log('ğŸ§ª Voice Chat Debug Test Started');

      // Test notification permissions
      async function testNotifications() {
        console.log('ğŸ”” Testing notification permissions...');
        if ('Notification' in window) {
          const permission = await Notification.requestPermission();
          console.log('ğŸ”” Permission:', permission);

          if (permission === 'granted') {
            new Notification('Test Notification', {
              body: 'Voice chat system is ready!',
              icon: '/favicon.ico',
            });
          }
        }
      }

      // Test audio context
      function testAudioContext() {
        console.log('ğŸµ Testing audio context...');
        try {
          const audioContext = new (
            window.AudioContext || window.webkitAudioContext
          )();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.2);

          console.log('âœ… Audio context test successful');
          return true;
        } catch (error) {
          console.error('âŒ Audio context test failed:', error);
          return false;
        }
      }

      // Test WebRTC support
      function testWebRTC() {
        console.log('ğŸ”— Testing WebRTC support...');

        const tests = {
          RTCPeerConnection: !!window.RTCPeerConnection,
          RTCDataChannel: !!window.RTCDataChannel,
          getUserMedia: !!(
            navigator.mediaDevices && navigator.mediaDevices.getUserMedia
          ),
          WebSocket: !!window.WebSocket,
        };

        console.log('ğŸ”— WebRTC Support:', tests);

        const allSupported = Object.values(tests).every(Boolean);
        if (allSupported) {
          console.log('âœ… WebRTC fully supported');
        } else {
          console.warn('âš ï¸ Some WebRTC features not supported');
        }

        return allSupported;
      }

      // Run all tests when page loads
      window.addEventListener('load', async () => {
        console.log('ğŸ§ª Running voice chat diagnostic tests...');

        await testNotifications();
        testAudioContext();
        testWebRTC();

        console.log('ğŸ§ª Diagnostic tests completed');
      });
    </script>
  </head>
  <body>
    <div
      style="
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      "
    >
      <h1>ğŸ§ª Voice Chat Debug Test</h1>

      <h2>ğŸ”§ Debug Steps:</h2>
      <ol>
        <li>Open browser developer console (F12)</li>
        <li>Check the console output for test results</li>
        <li>Verify all tests pass</li>
        <li>Test the actual voice chat in the application</li>
      </ol>

      <h2>ğŸ“‹ Test Checklist:</h2>
      <ul>
        <li>âœ… Notification permissions granted</li>
        <li>âœ… Audio context initialization</li>
        <li>âœ… WebRTC support detection</li>
        <li>âœ… Microphone access permissions</li>
        <li>âœ… Voice call signaling flow</li>
      </ul>

      <h2>ğŸ› Common Issues:</h2>
      <ul>
        <li><strong>No notifications:</strong> Check browser permissions</li>
        <li><strong>No audio:</strong> Check microphone permissions</li>
        <li><strong>No ringing:</strong> Check audio context initialization</li>
        <li><strong>No call connection:</strong> Check WebSocket connection</li>
      </ul>

      <button
        onclick="testNotifications()"
        style="padding: 10px 20px; margin: 5px"
      >
        ğŸ”” Test Notifications
      </button>
      <button
        onclick="testAudioContext()"
        style="padding: 10px 20px; margin: 5px"
      >
        ğŸµ Test Audio
      </button>
      <button onclick="testWebRTC()" style="padding: 10px 20px; margin: 5px">
        ğŸ”— Test WebRTC
      </button>

      <div
        id="results"
        style="
          margin-top: 20px;
          padding: 10px;
          background: #f5f5f5;
          border-radius: 5px;
        "
      >
        <p>Check the browser console for detailed test results.</p>
      </div>
    </div>
  </body>
</html>
