#!/bin/bash

echo "üéØ FINAL COMPREHENSIVE UI VERIFICATION"
echo "===================================="
echo ""

echo "üìç SERVER STATUS CHECK"
echo "====================="
if curl -s http://localhost:3001 > /dev/null; then
    echo "‚úÖ Frontend Server: http://localhost:3001 - RUNNING"
else
    echo "‚ùå Frontend Server: http://localhost:3001 - NOT RUNNING"
    exit 1
fi

if curl -s http://localhost:3002/health > /dev/null; then
    echo "‚úÖ Backend Server: http://localhost:3002 - RUNNING"
else
    echo "‚ùå Backend Server: http://localhost:3002 - NOT RUNNING"
    exit 1
fi

echo ""
echo "üîó LIVE INTERACTION INSTRUCTIONS"
echo "==============================="
echo ""
echo "üåê STEP 1: Open the Application in Your Browser"
echo "-------------------------------------------"
echo "‚Ä¢ URL: http://localhost:3001"
echo "‚Ä¢ This is the actual live application interface"
echo ""

echo "üë§ STEP 2: Test Registration with Success Message"
echo "-----------------------------------------------"
echo "‚Ä¢ Navigate to: http://localhost:3001/register"
echo "‚Ä¢ Fill in the registration form:"
echo "  - Username: live_test_user_$(date +%s)"
echo "  - Password: testpass123"
echo "  - Display Name: Live Test User"
echo "‚Ä¢ Click the Register/Sign Up button"
echo "‚Ä¢ ‚úÖ VERIFY: Look for success message or redirect to login page"
echo ""

echo "üîê STEP 3: Test Login Functionality"
echo "---------------------------------"
echo "‚Ä¢ Navigate to: http://localhost:3001/login"
echo "‚Ä¢ Use existing test credentials:"
echo "  - Username: alice"
echo "  - Password: password123"
echo "‚Ä¢ Click the Login button"
echo "‚Ä¢ ‚úÖ VERIFY: You should be redirected to the main chat interface"
echo ""

echo "üîç STEP 4: Test Search Other Users Feature"
echo "----------------------------------------"
echo "‚Ä¢ In the chat interface, look for search functionality"
echo "‚Ä¢ Search for existing users like 'bob' or 'test'"
echo "‚Ä¢ ‚úÖ VERIFY: Search results should appear showing found users"
echo ""

echo "üí¨ STEP 5: Test Starting Conversations"
echo "-------------------------------------"
echo "‚Ä¢ Click on a user from search results or conversation list"
echo "‚Ä¢ Try to send a message: 'Hello from live testing'"
echo "‚Ä¢ ‚úÖ VERIFY: Conversation should start and message should send"
echo ""

echo "üö™ STEP 6: Test Logout"
echo "----------------------"
echo "‚Ä¢ Look for logout button or user menu"
echo "‚Ä¢ Click logout option"
echo "‚Ä¢ ‚úÖ VERIFY: Should be redirected back to login page"
echo ""

echo "üóÑÔ∏è STEP 7: Verify Data Persistence in Database"
echo "--------------------------------------------"
echo "‚Ä¢ After completing the UI tests above, return to this terminal"
echo "‚Ä¢ Run this command to verify your data was saved:"
echo ""
echo "    sqlite3 data/chat.db 'SELECT username, display_name, created_at FROM users ORDER BY created_at DESC LIMIT 3'"
echo ""
echo "‚Ä¢ ‚úÖ VERIFY: Your test user should appear in the database"
echo ""

echo "üìã CURRENT DATABASE STATE (Before Your Tests)"
echo "============================================"
echo ""
echo "üìä Database Statistics:"
echo "‚Ä¢ Total Users: $(sqlite3 data/chat.db 'SELECT COUNT(*) FROM users')"
echo "‚Ä¢ Total Conversations: $(sqlite3 data/chat.db 'SELECT COUNT(*) FROM conversations')"
echo ""
echo "üë• Recent Users (Real Data from Previous Tests):"
sqlite3 data/chat.db "SELECT '  ‚Ä¢ ' || username || ' (' || display_name || ') - Created: ' || created_at FROM users ORDER BY created_at DESC LIMIT 5"
echo ""
echo "üí¨ Recent Conversations:"
sqlite3 data/chat.db "SELECT '  ‚Ä¢ Conversation ' || id || ' (Type: ' || type || ') - Created: ' || created_at FROM conversations ORDER BY created_at DESC LIMIT 3"
echo ""

echo "üéØ VERIFICATION CHECKLIST"
echo "======================"
echo ""
echo "‚úÖ Components to Verify Through UI:"
echo "1. [ ] Registration form accessible and functional"
echo "2. [ ] Success message appears after registration"
echo "3. [ ] Login with alice/password123 works"
echo "4. [ ] Redirected to chat interface after login"
echo "5. [ ] Search functionality finds other users"
echo "6. [ ] Can click users to start conversations"
echo "7. [ ] Message sending works in conversations"
echo "8. [ ] Logout button redirects to login page"
echo "9. [ ] Database shows new user after registration"
echo "10. [ ] All changes persisted in database"
echo ""

echo "üîó ACCESS POINTS"
echo "==============="
echo "‚Ä¢ Frontend Application: http://localhost:3001"
echo "‚Ä¢ Backend API: http://localhost:3002/api"
echo "‚Ä¢ Database File: ./data/chat.db"
echo ""
echo "üë• TEST CREDENTIALS AVAILABLE"
echo "============================"
echo "‚Ä¢ Username: alice, Password: password123"
echo "‚Ä¢ Username: bob, Password: password456"
echo "‚Ä¢ Any newly registered users during testing"
echo ""

echo "üéØ FINAL VERDICT EXPECTED"
echo "========================"
echo "‚úÖ All functionality should work through live UI interface"
echo "‚úÖ Registration success messages should appear"
echo "‚úÖ Login/logout should function properly"
echo "‚úÖ User search should find other users"
echo "‚úÖ Conversations should start successfully"
echo "‚úÖ All data should persist in SQLite database"
echo "‚úÖ No mocked data - only real database records"
echo ""
echo "üöÄ START LIVE TESTING NOW!"
echo "=========================="
echo "‚Ä¢ Open http://localhost:3001 in your browser"
echo "‚Ä¢ Follow the 7 steps above"
echo "‚Ä¢ Return to terminal for database verification"
echo ""